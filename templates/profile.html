{% extends "layout_base.html" %}


{% block content %}

<div class="vw-100 vh-100 fixed-top visualizzaizone-seguiti-follower d-none">
    <div class="visualizzaizone-seguiti-follower-box">
        <div class="row intestazione-box">
                <div class="col titolo">
                    <span id="intestazione"></span>
                </div>
                <div class="col-4 close">
                    <button class="btn" onclick="chiusura()">
                        <img class="close-icon self-align-end" src alt="close-button" height="24px" width="24px">
                    </button>
                </div>
            <div class="col-12 w-100 mt-1">
                <div class="row" id="row-seguiti-follower">


                    <!--
                    <div class="col-12 contact" id="{{ IDUtenteRemoto }}">
                        <div class="row">
                            <div class="col-1 contact-user-profile-img">
                                <img class="user-icon" src alt="" height="24px" width="24px">
                            </div>
                            <div class="col contact-user-name">
                                {{ nomeUtente }}
                                Nome Utente
                            </div>
                        </div>
                    </div>
                    -->



                </div>
            </div>
        </div>
    </div>
</div>

<!-- div per la visualizzaizone di un profilo-->
<div class="row info-user">
    <!-- div per contenere l'immaigne del profilo-->
    <div class="col-4 profile-image" >
        <img src="{{pathImmagineProfilo}}" alt="profile_picture" style="width: 50%; border-radius: 50%;">
    </div>
    <div class="col-8">
        <div class="row h-50">
            <!-- div dove viene visualizzato il nome dell'utente -->
            <div class="col profile-data nome-lg" style="font-size: 25px;">
                {{ nomeUtente }}
            </div>
            <!-- div dove vengono visualizzate i dati generali del profilo  -->
            <div class="col profile-data align-self-end align-self-sm-center">
                <span class="numero-dati">  <!-- numero di post dell'utente -->
                    {{numeroDiPost}} 
                </span><br>
                <span class="tipo-dati">
                    Post
                </span>
            </div>
            <div class="col profile-data align-self-end align-self-sm-center" id="Followers">
                <span class="numero-dati"> <!-- numero di seguaci dell'utente -->
                    {{seguaci}}
                </span><br>
                <span class="tipo-dati">
                    Followers
                </span>
            </div>
            <div class="col profile-data align-self-end align-self-sm-center" id="Seguiti">
                <span class="numero-dati"> <!-- numero di seguiti dell'utente-->
                    {{seguiti}}
                </span><br>
                <span class="tipo-dati">
                    Seguiti
                </span>
            </div>
        </div>
        <div class="row h-50">
            <!-- a seocnda se il profilo visuallizzato Ã¨ proprio o di qualcuno, rendo visibili i giusti pulsanti -->
            <div class="col profile-data flex-row">
                <input type="hidden"  id="c1" name="IDUtente" value="{{ ID }}">
                {% if is_owner == True %}
                <button class="btn widget-btn profile-btn" onclick="modificaprofilo()">Modifica</button> <!-- se sono il proprietario mostro il pulsante per modificare il profilo-->
                {% else %}
                    <!-- se non sono il proprietario mostro il pulsante per seguire l'utente-->
                    {% if is_following == True %}
                    <button class="btn widget-btn profile-btn" onclick="stop_seguiutente()">Non seguire</button>
                    {% else %}
                    <button class="btn widget-btn profile-btn" onclick="seguiutente()">Segui</button>
                    {% endif%}
                {% endif %}
                <button class="btn widget-btn profile-btn">Messaggi</button> <!-- mostro il pulsante per i messaggi-->
            </div>
        </div>
    </div>
</div>
<!-- dive per contenere la descrizione del profilo -->
<div class="row desc-user px-5 px-sm-0">
    <label class="desc-title" for="#desc">
        <b style="margin-left: 55px;">Descrizione</b>
    </label>
    <textarea class="desc-text" id="desc" readonly>
        {{descrizione}}
    </textarea>
    
</div>
<!-- div per contenere tutti i post del profilo -->
<!--
        <div class="row row-posts w-100">
            <div class="col col-post">
                <img src="{{url_for('static',filename='images/image1_carousel.png')}}" alt="" width="100%" height="100%">
            </div>
            <div class="col col-post">
                <img src="{{url_for('static',filename='images/image1_carousel.png')}}" alt="" width="100%" height="100%">
            </div>
            <div class="col col-post">
                <img src="{{url_for('static',filename='images/image1_carousel.png')}}" alt="" width="100%" height="100%">
            </div>
        </div>
-->
<div class="row post-user">
    <label class="title-post" for=""><b>POST</b></label>
    <div class="post-user-box mh-100">
        {% if is_owner == True or is_following == True or privacy == 0   %}
            <!-- profilo accessibile -->
            {% for post in user_posts %}

                {% if loop.index0 % 3 == 0 %}
                    <div class="row row-posts w-100">
                {% endif %}

                    <div class="col col-post">
                        <img src="{{ post['PercorsoFile'] }}" alt="post-utente" width="100%" height="100%">
                    </div>

                {% if loop.index0 % 3 == 2  %}
                    </div>
                {% endif %}
                
            {% endfor %}
            
            {% if num_buchi != 0 %}
                {% for n in range(num_buchi) %}
                <div class="col col-post">
                    <!-- div vuoto per riempire gli spazzi vuoti delle row da 3 di post -->
                </div>
                {% endfor %}
                </div>
            {% endif %}



        {% else %}
            <!-- profilo privato -->
        {% endif %}


        
    </div>
</div>


{% endblock %}

{% block script %}

<script>
    function chiusura(){
        $("#row-seguiti-follower").html("");
        $(".visualizzaizone-seguiti-follower").addClass("d-none");
    }

    // funzione per ottenere i profili seguiti da questo profilo 
    $("#Seguiti").on("click", function() {
        // ottengo l'id del profilo di cui si vuole sapere chi segue, dall'url della pagina
        var profileId = window.location.pathname.split('/').filter(Boolean).pop();  
        
        // faccio una richiesta al server con ajax 
        $.ajax({
            type: "GET", 
            url: "{{url_for('get_followed_profiles')}}", 
            data: { profile_id: profileId }, 
            success: function(response) { 
                response.forEach(d => {
                $("#row-seguiti-follower").append(`
                    <div class="col-12 contact" id="${d["IDProfilo"]}">
                        <div class="row">
                            <div class="col-1 contact-user-profile-img">
                                <img class="rounded-circle" src="${d["PathImmagineProfilo"]}" alt="" height="44px" width="44px">
                            </div>
                            <div class="col contact-user-name">
                                <a href="/profile/${d["IDProfilo"]}"">
                                <p class="nome-commenter">
                                    ${d["Nome"]} ${d["Cognome"]}
                                </p></a>
                            </div>
                        </div>
                    </div>`
                    )
                });
                $("#intestazione").html("Seguiti");
                $(".visualizzaizone-seguiti-follower").removeClass("d-none");

            },
            error: function(xhr, status, error) { 
                console.error("Errore nella richiesta Ajax:", error); // se avviene un errore 
            }
        });
    });

    // funzione per ottenere i profili che seguono questo profilo
    $("#Followers").on("click",function(){
    // ottengo l'id del profilo di cui si vuole sapere chi segue, dall'url della pagina
    var profileId = window.location.pathname.split('/').filter(Boolean).pop();  

    // faccio una richiesta al server con ajax per ottenere i profili follower
    $.ajax({
        type: "GET", 
        url: "{{ url_for('get_followers_profiles') }}", 
        data: { profile_id: profileId }, 
        success: function(response) { 

            response.forEach(d => {
                $("#row-seguiti-follower").append(`
                <div class="col-12 contact" id="${d["IDProfilo"]}">
                    <div class="row">
                        <div class="col-1 contact-user-profile-img">
                            <img class="rounded-circle" src="${d["PathImmagineProfilo"]}" alt="" height="44px" width="44px">
                        </div>
                        <div class="col contact-user-name">
                            <a href="/profile/${d["IDProfilo"]}">
                            <p class="nome-commenter">
                                ${d["Nome"]} ${d["Cognome"]}
                            </p></a>
                        </div>
                    </div>
                </div>`
                )
            });
            $("#intestazione").html("Followers");
            $(".visualizzaizone-seguiti-follower").removeClass("d-none");

        },
        error: function(xhr, status, error) { 
            console.error("Errore nella richiesta Ajax:", error); // se avviene un errore 
        }
    });
});
</script>

{% endblock %}
